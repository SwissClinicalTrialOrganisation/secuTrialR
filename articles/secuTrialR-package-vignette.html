<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>secuTrialR - a walkthrough • secuTrialR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="secuTrialR - a walkthrough">
<meta property="og:description" content="secuTrialR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">secuTrialR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/secuTrialR-package-vignette.html">secuTrialR - a walkthrough</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/SwissClinicalTrialOrganisation/secuTrialR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>secuTrialR - a walkthrough</h1>
                        <h4 data-toc-skip class="author">Patrick R.
Wright, Milica Markovic, Alan G. Haynes</h4>
            
            <h4 data-toc-skip class="date">2023-03-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SwissClinicalTrialOrganisation/secuTrialR/blob/HEAD/vignettes/secuTrialR-package-vignette.Rmd" class="external-link"><code>vignettes/secuTrialR-package-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>secuTrialR-package-vignette.Rmd</code></div>

    </div>

    
    
<div style="page-break-after: always;"></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<blockquote>
<p>“If I had just five minutes to chop down a tree I would spend the
first two and a half minutes sharpening my axe.”</p>
</blockquote>
<blockquote>
<footer>
— An anonymous woodsman
</footer>
</blockquote>
<p>This R package provides functions for handling data from the clinical
data management system (CDMS) <a href="https://www.secutrial.com/en/" class="external-link"></a>. The most important components
are related to reading data exports from secuTrial into R. In brief, the
package aims to enable swift execution of repetitive tasks in order to
allow spending more time on the unique aspects of a dataset. It is
developed and maintained by the Swiss Clinical Trial Organisation (<a href="https://www.scto.ch/en/news.html" class="external-link"></a>).</p>
<p>If you are still challenged by more basic operations in R we suggest
reading <a href="https://rstudio-education.github.io/hopr/" class="external-link"></a>, which
serves as an excellent introduction to the basic concepts of R.</p>
<p>This vignette will teach you how to use the <code>secuTrialR</code>
package and you will likely learn quite a bit about secuTrial exports in
general along the way. Throughout the <code>secuTrialR</code> package
and within this vignette we refer to patients, cases, subjects etc.
enrolled in a secuTrial database as participants.</p>
</div>
<div class="section level2">
<h2 id="install">Install<a class="anchor" aria-label="anchor" href="#install"></a>
</h2>
<p>Please note that <code>R versions &gt;= 3.5</code> should be used to
run <code>secuTrialR</code>. </p>
<p><strong>Stable release from CRAN</strong> </p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"secuTrialR"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Development release from GitHub with
<code>devtools</code></strong></p>
<p>For this you will need to have <code>devtools</code> installed. If
you are working on Windows and would like to install with
<code>devtools</code> you will likely need to install <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link"></a>. Installing
everything, including the dependencies, from scratch may take a while
(20-30 minutes).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"SwissClinicalTrialOrganisation/secuTrialR"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load silently</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SwissClinicalTrialOrganisation/secuTrialR" class="external-link">secuTrialR</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># show secuTrialR version</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"secuTrialR"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] '1.1.0'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-ctu05-dataset">The CTU05 dataset<a class="anchor" aria-label="anchor" href="#the-ctu05-dataset"></a>
</h2>
<p>Before we continue with the functionalities let’s briefly talk about
the test data which is delivered as a part of the package. We refer to
it as the <code>CTU05</code> (clinical trial unit project 05) data. This
dataset has been fabricated for demonstration purposes only and is not
real clinical data. Principally it is made up of eight forms. These are
called “surgeries”, “baseline”, “outcome”, “treatment”, “allmedi”,
“studyterminat”, “ae” and “sae”. You will see these names again later
when the data has been read into R. The project setup includes most data
types implementable in secuTrial. It is, however, not exhaustive. Since
the data is delivered with the installation of the
<code>secuTrialR</code> package we can point to it via the
<code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code> function. </p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctu05_data_location</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sT_exports"</span>, <span class="st">"exp_opt"</span>,</span>
<span>                                   <span class="st">"s_export_CSV-xls_CTU05_all_info.zip"</span>,</span>
<span>                                   package <span class="op">=</span> <span class="st">"secuTrialR"</span><span class="op">)</span></span></code></pre></div>
<p>If you work on your own datasets you can specify a path as a regular
character string without using <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="secutrial-export-options">secuTrial export options<a class="anchor" aria-label="anchor" href="#secutrial-export-options"></a>
</h2>
<p>Prior to reading your data into R you need to export it with the
secuTrial ExportSearchTool. We suggest exporting
<strong>non-rectangular</strong>, <strong>zipped</strong>,
<strong>English</strong> data with <strong>reference values</strong>
stored <strong>in a separate table</strong> including
<strong>Add-IDs</strong>, <strong>centre information</strong>,
<strong>structure information</strong>, <strong>form status</strong>,
<strong>project setup</strong>, <strong>without duplicated meta
data</strong> and <strong>without form data of hidden fields</strong>.
Furthermore, it is important to use <strong>“CSV
format”</strong>/<strong>“CSV format for MS Excel”</strong> and
suggested to select <strong>UTF-8</strong> encoding. Most of these
options are truly optional and reading your data should work even with
differences from the above specifications.</p>
<p>A description of how data can be exported from secuTrial can be found
<a href="https://swissclinicaltrialorganisation.github.io/secuTrial_recipes/export_data/" class="external-link"></a>.
This description includes screenshots of the export options
configuration interface.</p>
</div>
<div class="section level2">
<h2 id="reading-a-secutrial-data-export-into-r">Reading a secuTrial data export into R<a class="anchor" aria-label="anchor" href="#reading-a-secutrial-data-export-into-r"></a>
</h2>
<p>There is one principle function to read your data
(i.e. <code><a href="../reference/read_secuTrial.html">read_secuTrial()</a></code>). Below you can see it in action
with the <code>CTU05</code> dataset. </p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctu05_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_secuTrial.html">read_secuTrial</a></span><span class="op">(</span>data_dir <span class="op">=</span> <span class="va">ctu05_data_location</span><span class="op">)</span></span>
<span><span class="co">#&gt; Read export successfully.</span></span>
<span><span class="co">#&gt; The following export options deviate from the suggested specifications:</span></span>
<span><span class="co">#&gt; Data from hidden fields is part of the export.</span></span></code></pre></div>
<p>If the “Read export successfully.” message appears your data was
correctly read. In this example you are also warned that hidden data
fields are in the export which is a deviation from the suggested export
option configuraion.</p>
</div>
<div class="section level2">
<h2 id="the-secutrialdata-object">The <code>secuTrialdata</code> object<a class="anchor" aria-label="anchor" href="#the-secutrialdata-object"></a>
</h2>
<p>If you inspect the <code><a href="https://rdrr.io/r/base/class.html" class="external-link">class()</a></code> of <code>ctu05_data</code>
you will find that it is a <code>secuTrialdata</code> object. </p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "secuTrialdata"</span></span></code></pre></div>
<p>Really this is only a <code>list</code> containing all the
information from your secuTrial export. </p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<div class="section level3">
<h3 id="the-data-tables-in-the-secutrialdata-object">The data tables in the <code>secuTrialdata</code> object<a class="anchor" aria-label="anchor" href="#the-data-tables-in-the-secutrialdata-object"></a>
</h3>
<p>We have implemented a custom variation of the <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>
function for <code>secuTrialdata</code> objects.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; secuTrial data imported from:</span></span>
<span><span class="co">#&gt; /Users/runner/work/_temp/Library/secuTrialR/extdata/sT_exports/exp_opt/s_export_CSV-xls_CTU05_all_info.zip </span></span>
<span><span class="co">#&gt;            table nrow ncol  meta       original_name</span></span>
<span><span class="co">#&gt;               vp    4   12  TRUE              vp.xls</span></span>
<span><span class="co">#&gt;             vpfs    8    2  TRUE            vpfs.xls</span></span>
<span><span class="co">#&gt;               fs    8    8  TRUE              fs.xls</span></span>
<span><span class="co">#&gt;               qs   29    8  TRUE              qs.xls</span></span>
<span><span class="co">#&gt;               is   85    9  TRUE              is.xls</span></span>
<span><span class="co">#&gt;              ctr    3    3  TRUE             ctr.xls</span></span>
<span><span class="co">#&gt;               cn   11   15  TRUE              cn.xls</span></span>
<span><span class="co">#&gt;             atcn    0    9  TRUE            atcn.xls</span></span>
<span><span class="co">#&gt;            atcvp    0   16  TRUE           atcvp.xls</span></span>
<span><span class="co">#&gt;              qac    0   12  TRUE             qac.xls</span></span>
<span><span class="co">#&gt;              cts    0   10  TRUE             cts.xls</span></span>
<span><span class="co">#&gt;              miv    0   10  TRUE             miv.xls</span></span>
<span><span class="co">#&gt;            atmiv    0   15 FALSE           atmiv.xls</span></span>
<span><span class="co">#&gt;         baseline   17  107 FALSE        baseline.xls</span></span>
<span><span class="co">#&gt;       atbaseline    0   79 FALSE      atbaseline.xls</span></span>
<span><span class="co">#&gt;          outcome   13   48 FALSE         outcome.xls</span></span>
<span><span class="co">#&gt;        atoutcome    5   47 FALSE       atoutcome.xls</span></span>
<span><span class="co">#&gt;        treatment   11   44 FALSE       treatment.xls</span></span>
<span><span class="co">#&gt;      attreatment    0   45 FALSE     attreatment.xls</span></span>
<span><span class="co">#&gt;          allmedi   17   47 FALSE         allmedi.xls</span></span>
<span><span class="co">#&gt;        atallmedi    2   47 FALSE       atallmedi.xls</span></span>
<span><span class="co">#&gt;    studyterminat   10   41 FALSE   studyterminat.xls</span></span>
<span><span class="co">#&gt;  atstudyterminat    1   39 FALSE atstudyterminat.xls</span></span>
<span><span class="co">#&gt;               ae    1   66 FALSE              ae.xls</span></span>
<span><span class="co">#&gt;             atae    0   58 FALSE            atae.xls</span></span>
<span><span class="co">#&gt;              sae    2   64 FALSE             sae.xls</span></span>
<span><span class="co">#&gt;            atsae    0   57 FALSE           atsae.xls</span></span>
<span><span class="co">#&gt;       esurgeries   18   11 FALSE      esurgeries.xls</span></span>
<span><span class="co">#&gt;     atesurgeries    0    9 FALSE    atesurgeries.xls</span></span>
<span><span class="co">#&gt;               cl  205    3  TRUE              cl.xls</span></span>
<span><span class="co">#&gt;            atae1    0   20 FALSE           atae1.xls</span></span></code></pre></div>
<p>It shows you where the export archive of your
<code>secuTrialdata</code> object is located, tells you which data
tables (i.e. <code>table</code>) it contains, what the source files
(i.e. <code>original_name</code>) are and specifies each table’s
dimensions (i.e. <code>ncol</code>, <code>nrow</code>).</p>
<p>By now you have possibly realized that all the forms specified
earlier (i.e. “surgeries”, “baseline”, “outcome”, “treatment”,
“allmedi”, “studyterminat”, “ae” and “sae”) are present, but also that
there are many tables that do not correspond to the previously
introduced forms.</p>
<p>The majority of the unfamiliar tables are tagged as <code>TRUE</code>
in the <code>meta</code> column. This means that they are metadata
tables. Their names and data structures are fixed in secuTrial exports.
In the following we will briefly explain which information the most
relevant meta tables contain.</p>
<ul>
<li>
<code>vp</code> - visitplan definition</li>
<li>
<code>vpfs</code> - visitplan form linkage</li>
<li>
<code>fs</code> - forms information</li>
<li>
<code>qs</code> - questions</li>
<li>
<code>is</code> - items i.e. variable definitions</li>
<li>
<code>ctr</code> - centre information</li>
<li>
<code>cn</code> - casenodes i.e. table of entered study
participants</li>
<li>
<code>cl</code> - information how the data in the variables is
coded</li>
</ul>
<p>Furthermore, there is a set of tables whose names start with “at”.
These are audit trail tables. They are only relevant if you need to
investigate changes in the data over time. For example certain values
may be corrected (i.e. changed) due to findings during monitoring visits
at study centres. Last but not least you may have also realized that the
“surgeries” table is called <code>esurgeries</code>. This is because it
is a so-called repetition form. Repetition forms are labelled with a
leading “e” and are implemented as subforms in other forms. In this
case, <code>esurgeries</code> is a subform in <code>baseline</code> and
the linkage is defined by the <code>mnpdocid</code> column in both
tables. If this sounds cryptic to you we suggest you talk so someone who
has implemented a database in secuTrial and let them explain it with a
specific example. It is pretty straight forward when you look at a
concrete implementation.</p>
</div>
<div class="section level3">
<h3 id="accessing-the-tables-and-values">Accessing the tables and values<a class="anchor" aria-label="anchor" href="#accessing-the-tables-and-values"></a>
</h3>
<p>Since the <code>secuTrialdata</code> object is a <code>list</code>
and the data tables within this <code>list</code> are
<code>data.frame</code>s you can simply access the tables using
<code>$</code>. Let’s say you would like to have a look at the placebo
to verum ratio in your <code>treatment</code> data or what types of
other medication were entered in <code>allmedi</code>. </p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">rando_treatment</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Placebo   Verum </span></span>
<span><span class="co">#&gt;       8       3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">allmedi</span><span class="op">$</span><span class="va">med_product</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Amoxicillin Doxycycline    Importal </span></span>
<span><span class="co">#&gt;           2           1           3</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-transformations">Data transformations<a class="anchor" aria-label="anchor" href="#data-transformations"></a>
</h3>
<p>During the loading process, coded categorical data is transformed.
For example the <code>gender</code> variable in the
<code>baseline</code> form is categorical. The raw data is accessible
via <code>gender</code> and the transformed version of the data is added
during the reading process and becomes accessible via
<code>gender.factor</code>. Thus, data is not overwritten but added with
the <code>.factor</code> extension. If there are issues during
factorization a <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> will inform you of this. </p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raw gender data</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">gender</span></span>
<span><span class="co">#&gt;  [1]  1 NA NA  2  1  2  1 NA NA  1  2 NA NA  1  2  2 NA</span></span>
<span><span class="co">#&gt; attr(,"label")</span></span>
<span><span class="co">#&gt; [1] "Gender"</span></span>
<span></span>
<span><span class="co"># transformed gender data</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">gender.factor</span></span>
<span><span class="co">#&gt;  [1] male   &lt;NA&gt;   &lt;NA&gt;   female male   female male   &lt;NA&gt;   &lt;NA&gt;   male  </span></span>
<span><span class="co">#&gt; [11] female &lt;NA&gt;   &lt;NA&gt;   male   female female &lt;NA&gt;  </span></span>
<span><span class="co">#&gt; attr(,"label")</span></span>
<span><span class="co">#&gt; [1] Gender</span></span>
<span><span class="co">#&gt; Levels: male female</span></span>
<span></span>
<span><span class="co"># raw more meds</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">allmedi</span><span class="op">$</span><span class="va">no_more_meds</span></span>
<span><span class="co">#&gt;  [1] 1 1 0 1 1 1 0 0 0 1 0 0 1 1 1 1 0</span></span>
<span><span class="co">#&gt; attr(,"label")</span></span>
<span><span class="co">#&gt; [1] "No further medication"</span></span>
<span></span>
<span><span class="co"># transformed more meds</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">allmedi</span><span class="op">$</span><span class="va">no_more_meds.factor</span></span>
<span><span class="co">#&gt;  [1] yes yes no  yes yes yes no  no  no  yes no  no  yes yes yes yes no </span></span>
<span><span class="co">#&gt; attr(,"label")</span></span>
<span><span class="co">#&gt; [1] No further medication</span></span>
<span><span class="co">#&gt; Levels: no yes</span></span></code></pre></div>
<p>Note that descriptive labels have also been automatically added to
the data. </p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/labels_secuTrial.html">label</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">allmedi</span><span class="op">$</span><span class="va">no_more_meds.factor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "No further medication"</span></span>
<span><span class="fu"><a href="../reference/labels_secuTrial.html">label</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">gender.factor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Gender"</span></span>
<span><span class="fu"><a href="../reference/labels_secuTrial.html">label</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">esurgeries</span><span class="op">$</span><span class="va">surgery_organ.factor</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Organ"</span></span></code></pre></div>
<p>Datetime data is also transformed and similarly to the factorization
process the names are concatenated with <code>.date</code> or
<code>.datetime</code>. </p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raw</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">visit_date</span></span>
<span><span class="co">#&gt;  [1] 20190401 20190402 20190403 20190402 20190403 20190404 20190405 20190406</span></span>
<span><span class="co">#&gt;  [9] 20190407 20190411 20190412 20190413 20190414 20190413 20190414 20190415</span></span>
<span><span class="co">#&gt; [17] 20180501</span></span>
<span><span class="co">#&gt; attr(,"label")</span></span>
<span><span class="co">#&gt; [1] "Date of visit"</span></span>
<span></span>
<span><span class="co"># processed</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">visit_date.date</span></span>
<span><span class="co">#&gt;  [1] "2019-04-01" "2019-04-02" "2019-04-03" "2019-04-02" "2019-04-03"</span></span>
<span><span class="co">#&gt;  [6] "2019-04-04" "2019-04-05" "2019-04-06" "2019-04-07" "2019-04-11"</span></span>
<span><span class="co">#&gt; [11] "2019-04-12" "2019-04-13" "2019-04-14" "2019-04-13" "2019-04-14"</span></span>
<span><span class="co">#&gt; [16] "2019-04-15" "2018-05-01"</span></span>
<span></span>
<span><span class="co"># raw only head</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">hiv_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 201903052356           NA           NA           NA           NA</span></span>
<span><span class="co">#&gt; [6]           NA</span></span>
<span></span>
<span><span class="co"># processed only head</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">hiv_date.datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2019-03-05 23:56:00 UTC" NA                       </span></span>
<span><span class="co">#&gt; [3] NA                        NA                       </span></span>
<span><span class="co">#&gt; [5] NA                        NA</span></span>
<span></span>
<span><span class="co"># classes</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">visit_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "integer"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">visit_date.date</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Date"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">hiv_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "numeric"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">hiv_date.datetime</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "POSIXct" "POSIXt"</span></span></code></pre></div>
<p>Depending on the setup, incomplete dates can be valid entries in a
secuTrial database. Thus they will also occasionally appear in your
exports. The datetime conversion does not work in these cases and
<code>NA</code>s are created. If this happens, <code>secuTrialR</code>
will warn you accordingly and you should have a closer look into the
affected datetime variables and whether you would like to perform
so-called date imputation.</p>
</div>
<div class="section level3">
<h3 id="export-options">Export options<a class="anchor" aria-label="anchor" href="#export-options"></a>
</h3>
<p>The <code>secuTrialdata</code> object also contains information on
the export options. </p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">export_options</span></span>
<span><span class="co">#&gt; secuTrial version: 5.5.1.10 </span></span>
<span><span class="co">#&gt; Time of export on server: 03.10.2019 - 14:43:49 (CEST) </span></span>
<span><span class="co">#&gt; Project version: (20.06.2019 - 11:22:04 (CEST)) </span></span>
<span><span class="co">#&gt; Exported with short names </span></span>
<span><span class="co">#&gt; File extension: xls </span></span>
<span><span class="co">#&gt; Seperator: ' '</span></span>
<span><span class="co">#&gt; 32 files exported</span></span>
<span><span class="co">#&gt;   including 13 metadata tables</span></span>
<span><span class="co">#&gt; Reference values exported - factorize possible</span></span>
<span><span class="co">#&gt; Metadata tables:</span></span>
<span><span class="co">#&gt;              type exportname available</span></span>
<span><span class="co">#&gt;             forms         fs      TRUE</span></span>
<span><span class="co">#&gt;         casenodes         cn      TRUE</span></span>
<span><span class="co">#&gt;           centres        ctr      TRUE</span></span>
<span><span class="co">#&gt;             items         is      TRUE</span></span>
<span><span class="co">#&gt;         questions         qs      TRUE</span></span>
<span><span class="co">#&gt;           queries        qac      TRUE</span></span>
<span><span class="co">#&gt;         visitplan         vp      TRUE</span></span>
<span><span class="co">#&gt;    visitplanforms       vpfs      TRUE</span></span>
<span><span class="co">#&gt;       atcasenodes       atcn      TRUE</span></span>
<span><span class="co">#&gt;  atcasevisitplans      atcvp      TRUE</span></span>
<span><span class="co">#&gt;          comments        cts      TRUE</span></span>
<span><span class="co">#&gt;               miv        miv      TRUE</span></span>
<span><span class="co">#&gt;                cl         cl      TRUE</span></span></code></pre></div>
<p><code>export_options</code> itself is a <code>list</code>. If you are
interested in more information than is printed you can also access it.
Let’s assume you would like to know the <code>project_name</code> and
<code>encoding</code>. </p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">export_options</span><span class="op">$</span><span class="va">project_name</span></span>
<span><span class="co">#&gt; [1] "secuTrialR example CDMA"</span></span>
<span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">export_options</span><span class="op">$</span><span class="va">encoding</span></span>
<span><span class="co">#&gt; [1] "UTF-8"</span></span></code></pre></div>
<p>Much more information is stored in the elements of
<code>export_options</code>. The names of the elements should be
descriptive enough to infer the contents. </p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">export_options</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "sep"                "date_format"        "datetime_format"   </span></span>
<span><span class="co">#&gt;  [4] "date_format_meta"   "na.strings"         "short_names"       </span></span>
<span><span class="co">#&gt;  [7] "is_zip"             "is_rectangular"     "audit_trail"       </span></span>
<span><span class="co">#&gt; [10] "column_names"       "lang_not_supported" "dict_items"        </span></span>
<span><span class="co">#&gt; [13] "refvals_separate"   "add_id"             "lab_id"            </span></span>
<span><span class="co">#&gt; [16] "meta_names"         "meta_available"     "duplicate_meta"    </span></span>
<span><span class="co">#&gt; [19] "all_files"          "data_files"         "data_names"        </span></span>
<span><span class="co">#&gt; [22] "file_end"           "extension"          "data_dir"          </span></span>
<span><span class="co">#&gt; [25] "secuTrial_version"  "project_version"    "project_name"      </span></span>
<span><span class="co">#&gt; [28] "format_info"        "time_of_export"     "encoding"          </span></span>
<span><span class="co">#&gt; [31] "form_status"        "centre_info"        "hidden_fields"     </span></span>
<span><span class="co">#&gt; [34] "structure"          "proj_setup"         "factorized"        </span></span>
<span><span class="co">#&gt; [37] "dated"              "labelled"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="generic-functions-for-secutrialdata-objects">Generic functions for <code>secuTrialdata</code> objects<a class="anchor" aria-label="anchor" href="#generic-functions-for-secutrialdata-objects"></a>
</h2>
<p>Now that you understand the <code>secuTrialdata</code> object we will
show you some generic functions you can use on objects of this
class.</p>
<div class="section level3">
<h3 id="show-the-study-participants">Show the study participants<a class="anchor" aria-label="anchor" href="#show-the-study-participants"></a>
</h3>
<p>First off you may be interested in a table of participants. </p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_participants.html">get_participants</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    mnppid        mnpaid mnpctrid                       mnpctrname</span></span>
<span><span class="co">#&gt; 1    1204 RPACK-CBE-001      462           Charité Berlin (RPACK)</span></span>
<span><span class="co">#&gt; 2    1205 RPACK-CBE-002      462           Charité Berlin (RPACK)</span></span>
<span><span class="co">#&gt; 3    1206 RPACK-CBE-003      462           Charité Berlin (RPACK)</span></span>
<span><span class="co">#&gt; 4    1207 RPACK-CBE-004      462           Charité Berlin (RPACK)</span></span>
<span><span class="co">#&gt; 5    1208 RPACK-CBE-005      462           Charité Berlin (RPACK)</span></span>
<span><span class="co">#&gt; 6    1209 RPACK-INS-011      461         Inselspital Bern (RPACK)</span></span>
<span><span class="co">#&gt; 7    1210 RPACK-INS-012      461         Inselspital Bern (RPACK)</span></span>
<span><span class="co">#&gt; 8    1211 RPACK-INS-013      461         Inselspital Bern (RPACK)</span></span>
<span><span class="co">#&gt; 9    1212 RPACK-INS-014      461         Inselspital Bern (RPACK)</span></span>
<span><span class="co">#&gt; 10   1213 RPACK-INS-015      461         Inselspital Bern (RPACK)</span></span>
<span><span class="co">#&gt; 11   1214 RPACK-USB-123      441 Universitätsspital Basel (RPACK)</span></span></code></pre></div>
<p>Please note that the <code>mnpaid</code> column in this table
corresponds to the <code>pat_id</code> column in other tables.</p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level3">
<h3 id="recruitment-over-time">Recruitment over time<a class="anchor" aria-label="anchor" href="#recruitment-over-time"></a>
</h3>
<p>You can extract information about participant recruitment per centre
and year by applying <code><a href="../reference/annual_recruitment.html">annual_recruitment()</a></code> on a
<code>secuTrialdata</code> object. </p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/annual_recruitment.html">annual_recruitment</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;                             Center Total 2018 2019</span></span>
<span><span class="co">#&gt; 1                              All    11    1   10</span></span>
<span><span class="co">#&gt; 2           Charité Berlin (RPACK)     5    0    5</span></span>
<span><span class="co">#&gt; 3         Inselspital Bern (RPACK)     5    0    5</span></span>
<span><span class="co">#&gt; 4 Universitätsspital Basel (RPACK)     1    1    0</span></span></code></pre></div>
<p>Since the centre names often have a systematic addition
(e.g. (RPACK)) we have enabled the option to remove certain parts of the
centre descriptions via regular expressions (i.e. <code>rm_regex</code>
argument). In this case the regular expression removes trailing
parentheses and everything they enclose. </p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/annual_recruitment.html">annual_recruitment</a></span><span class="op">(</span><span class="va">ctu05_data</span>, rm_regex <span class="op">=</span> <span class="st">"\\(.*\\)$"</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     Center Total 2018 2019</span></span>
<span><span class="co">#&gt; 1                      All    11    1   10</span></span>
<span><span class="co">#&gt; 2           Charité Berlin     5    0    5</span></span>
<span><span class="co">#&gt; 3         Inselspital Bern     5    0    5</span></span>
<span><span class="co">#&gt; 4 Universitätsspital Basel     1    1    0</span></span></code></pre></div>
<p>It is also possible to plot the recruitment over time. </p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_recruitment.html">plot_recruitment</a></span><span class="op">(</span><span class="va">ctu05_data</span>, cex <span class="op">=</span> <span class="fl">1.2</span>, rm_regex <span class="op">=</span> <span class="st">"\\(.*\\)$"</span><span class="op">)</span></span></code></pre></div>
<p><img src="secuTrialR-package-vignette_files/figure-html/unnamed-chunk-20-1.png" width="768"></p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level3">
<h3 id="visit-plan-visualization">Visit plan visualization<a class="anchor" aria-label="anchor" href="#visit-plan-visualization"></a>
</h3>
<p><code>secuTrialR</code> can provide a depiction of the visit
structure, although only where the visit plan is fixed. Black rectangles
in the grid represent a form to be filled (x) during one of the visits
(y). </p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visit_structure.html">visit_structure</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vs</span><span class="op">)</span></span></code></pre></div>
<p><img src="secuTrialR-package-vignette_files/figure-html/unnamed-chunk-21-1.png" width="374.4"></p>
</div>
<div class="section level3">
<h3 id="completeness-of-forms">Completeness of forms<a class="anchor" aria-label="anchor" href="#completeness-of-forms"></a>
</h3>
<p>If you are not sure about how complete the data in your export is, it
may be useful to get a quick overview of how well the forms have been
filled. The below table shows both absolute and relative numbers for a
few forms. </p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/form_status_summary.html">form_status_summary</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">fss</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;        form_name partly_filled completely_filled empty with_warnings</span></span>
<span><span class="co">#&gt; 6       baseline             3                14     0             0</span></span>
<span><span class="co">#&gt; 7        outcome             1                12     0             0</span></span>
<span><span class="co">#&gt; 8            sae             0                 2     0             0</span></span>
<span><span class="co">#&gt; 9  studyterminat             0                10     0             0</span></span>
<span><span class="co">#&gt; 10     treatment             0                11     0             0</span></span>
<span><span class="co">#&gt;    with_errors partly_filled.percent completely_filled.percent empty.percent</span></span>
<span><span class="co">#&gt; 6            0            0.17647059                 0.8235294             0</span></span>
<span><span class="co">#&gt; 7            0            0.07692308                 0.9230769             0</span></span>
<span><span class="co">#&gt; 8            0            0.00000000                 1.0000000             0</span></span>
<span><span class="co">#&gt; 9            0            0.00000000                 1.0000000             0</span></span>
<span><span class="co">#&gt; 10           0            0.00000000                 1.0000000             0</span></span>
<span><span class="co">#&gt;    with_warnings.percent with_errors.percent form_count</span></span>
<span><span class="co">#&gt; 6                      0                   0         17</span></span>
<span><span class="co">#&gt; 7                      0                   0         13</span></span>
<span><span class="co">#&gt; 8                      0                   0          2</span></span>
<span><span class="co">#&gt; 9                      0                   0         10</span></span>
<span><span class="co">#&gt; 10                     0                   0         11</span></span></code></pre></div>
<p>Please note that a form is only complete if all required fields have
been filled. Thus, a whole study may have 99% completeness on variable
basis while showing 0% completeness on form basis. It is currently not
technically possible to assess completeness on variable basis in a
generic way. Hence, high completeness on form basis implies high
completeness on variable basis but <strong>NOT</strong> vice versa.</p>
<p>If you would rather retrieve information on form completeness for
each participant individually you can perform the following. </p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fsc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/form_status_counts.html">form_status_counts</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co"># show the top</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fsc</span><span class="op">)</span></span>
<span><span class="co">#&gt;          pat_id form_name completely_filled partly_filled empty with_warnings</span></span>
<span><span class="co">#&gt; 1 RPACK-CBE-001  baseline                 3             0     0             0</span></span>
<span><span class="co">#&gt; 2 RPACK-CBE-002  baseline                 1             0     0             0</span></span>
<span><span class="co">#&gt; 3 RPACK-CBE-003  baseline                 1             0     0             0</span></span>
<span><span class="co">#&gt; 4 RPACK-CBE-004  baseline                 1             0     0             0</span></span>
<span><span class="co">#&gt; 5 RPACK-CBE-005  baseline                 1             2     0             0</span></span>
<span><span class="co">#&gt; 6 RPACK-INS-011  baseline                 1             0     0             0</span></span>
<span><span class="co">#&gt;   with_errors</span></span>
<span><span class="co">#&gt; 1           0</span></span>
<span><span class="co">#&gt; 2           0</span></span>
<span><span class="co">#&gt; 3           0</span></span>
<span><span class="co">#&gt; 4           0</span></span>
<span><span class="co">#&gt; 5           0</span></span>
<span><span class="co">#&gt; 6           0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="form-linkage">Form linkage<a class="anchor" aria-label="anchor" href="#form-linkage"></a>
</h3>
<p>Linkages amongst forms can be explored with the
<code><a href="../reference/links_secuTrial.html">links_secuTrial()</a></code> function. This relies on the
<code>igraph</code> package to create a network. It is possible to
interact with the network, e.g. move nodes around in order to read the
labels better. The R graphics device ID is returned to the console, but
can be ignored. Forms are plotted in deep yellow, variables in light
blue. </p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/links_secuTrial.html">links_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span></code></pre></div>
<p>The output can not be shown within this vignette but you should give
it a try. Please note that the linkage plot is likely most useful
<strong>without</strong> the audit trail data in the export.</p>
<div style="page-break-after: always;"></div>
</div>
<div class="section level3">
<h3 id="sampling-random-participants">Sampling random participants<a class="anchor" aria-label="anchor" href="#sampling-random-participants"></a>
</h3>
<p>During study monitoring it is common practice to check random
participants from a study database. These participants should be
retrieved in a reproducible fashion, which can be achieved by setting a
so-called seed. The below function allows reproducible retrieval for a
loaded secuTrial data export. </p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># randomly retrieve at least 25 percent of participants recorded after March 18th 2019</span></span>
<span><span class="co"># from the centres "Inselspital Bern" and "Charité Berlin"</span></span>
<span><span class="fu"><a href="../reference/return_random_participants.html">return_random_participants</a></span><span class="op">(</span><span class="va">ctu05_data</span>,</span>
<span>                           percent <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>                           seed <span class="op">=</span> <span class="fl">1337</span>,</span>
<span>                           date <span class="op">=</span> <span class="st">"2019-03-18"</span>,</span>
<span>                           centres <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Inselspital Bern (RPACK)"</span>,</span>
<span>                                       <span class="st">"Charité Berlin (RPACK)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;          mnpaid                   centre mnpvisstartdate</span></span>
<span><span class="co">#&gt; 2 RPACK-INS-012 Inselspital Bern (RPACK)      2019-04-12</span></span>
<span><span class="co">#&gt; 4 RPACK-INS-014 Inselspital Bern (RPACK)      2019-04-14</span></span>
<span><span class="co">#&gt; 5 RPACK-CBE-005   Charité Berlin (RPACK)      2019-04-05</span></span>
<span><span class="co">#&gt; 3 RPACK-CBE-003   Charité Berlin (RPACK)      2019-04-03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rng_config</span></span>
<span><span class="co">#&gt; [1] "Mersenne-Twister" "Inversion"        "Rejection"</span></span></code></pre></div>
<p>Please note that earlier R versions may return different results
because there is a different <code>rng_config</code>
(i.e. <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">RNGkind()</a></code>). For this reason we have added the
<code>rng_config</code> to the output.</p>
</div>
<div class="section level3">
<h3 id="retrieve-score-variables">Retrieve score variables<a class="anchor" aria-label="anchor" href="#retrieve-score-variables"></a>
</h3>
<p>secuTrial allows implementing calculated variables (i.e. scores).
Data is not directly entered into these variables but rather calculated
automatically. Scores are defined by a set of rules and use the data in
other variables as basis. For example the age of a study participant at
data entry can be calculated as the difference between the participant’s
birthday and the day of data entry.</p>
<p>It is advisable to recalculate or validate score variable data before
data analysis. A rule of thumb: The more complex a score is and the more
data from different forms is necessary for its calculation the more
likely its value should be recalculated. The below function will allow
you to detect which variables this concerns. </p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/return_scores.html">return_scores</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   name                  itemtype label</span></span>
<span><span class="co">#&gt; 1  age Years y (calculated only)   Age</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-hidden-variables">Retrieve hidden variables<a class="anchor" aria-label="anchor" href="#retrieve-hidden-variables"></a>
</h3>
<p>Sometimes, during a study, certain fields may be hidden because data
should no longer be entered into them. If this is the case and the data
of these fields is part of your export is likely good to know about it.
In this case nothing is hidden. </p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/return_hidden_items.html">return_hidden_items</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] name     itemtype label   </span></span>
<span><span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="finding-changesdifferences-in-project-setup-implementations">Finding changes/differences in project setup implementations<a class="anchor" aria-label="anchor" href="#finding-changesdifferences-in-project-setup-implementations"></a>
</h3>
<p>In ongoing studies it is possible that changes to the secuTrial data
entry interface (i.e. the electronic case report forms) are made.
Sometimes these changes may call for adjustments in analysis code. It is
considered good practice to run <code><a href="../reference/diff_secuTrial.html">diff_secuTrial()</a></code> on the
last export and the current export of a project to at least make
yourself aware of potential changes in the setup. If there are
differences, the results of this function should be interpreted as a
first indicator since they may not cover all alterations. Information is
returned on forms and variables. A detailed list of changes can be
produced in the secuTrial FormBuilder with “Compare project setup”.</p>
<p>For the below <code><a href="../reference/diff_secuTrial.html">diff_secuTrial()</a></code> showcase we emulated a
changed setup of CTU05 by copying the setup and importing it in the
FormBuilder as a new secuTrial project (CTU06). From this, we created a
data export (v1) and then made a few minor changes and exported again
(v2). If this sounds confusing, never mind. CTU06 v1 is simply a copy of
CTU05. CTU06 v2 is a slighly altered version of CTU06 v1. </p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ctu06_v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_secuTrial.html">read_secuTrial</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sT_exports"</span>, <span class="st">"change_tracking"</span>,</span>
<span>                                       <span class="st">"s_export_CSV-xls_CTU06_version1.zip"</span>,</span>
<span>                                       package <span class="op">=</span> <span class="st">"secuTrialR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Read export successfully.</span></span>
<span><span class="co">#&gt; The following export options deviate from the suggested specifications:</span></span>
<span><span class="co">#&gt; Data from hidden fields is part of the export.</span></span>
<span><span class="co">#&gt; Short names was not selected.</span></span>
<span></span>
<span><span class="va">ctu06_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_secuTrial.html">read_secuTrial</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sT_exports"</span>, <span class="st">"change_tracking"</span>,</span>
<span>                                       <span class="st">"s_export_CSV-xls_CTU06_version2.zip"</span>,</span>
<span>                                       package <span class="op">=</span> <span class="st">"secuTrialR"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Read export successfully.</span></span>
<span><span class="co">#&gt; The following export options deviate from the suggested specifications:</span></span>
<span><span class="co">#&gt; Data from hidden fields is part of the export.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/diff_secuTrial.html">diff_secuTrial</a></span><span class="op">(</span><span class="va">ctu06_v1</span>, <span class="va">ctu06_v2</span><span class="op">)</span></span>
<span><span class="co">#&gt; $new_forms</span></span>
<span><span class="co">#&gt; [1] "mnpctu06anewform"       "mnpctu06anothernewform"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $new_variables</span></span>
<span><span class="co">#&gt; [1] "new_item_in_fu"       "new_item_in_new_form"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $removed_forms</span></span>
<span><span class="co">#&gt; character(0)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $removed_variables</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>As you can see <code>ctu06_v2</code> contains the two additional
forms <code>mnpctu06anewform</code> and
<code>mnpctu06anothernewform</code> and the two additional variables
<code>new_item_in_fu</code> and <code>new_item_in_new_form</code>.</p>
</div>
<div class="section level3">
<h3 id="conversion-to-spss-stata-sas">Conversion to SPSS, STATA, SAS<a class="anchor" aria-label="anchor" href="#conversion-to-spss-stata-sas"></a>
</h3>
<p>Given that you are working with R it is unlikely that you need such
conversions for yourself. However, collaborators may ask for data which
is readily importable into SPSS, STATA or SAS. For this you can use
<code><a href="../reference/write_secuTrial.html">write_secuTrial()</a></code>.</p>
<p>Since this has not been heavily tested or used there may be issues
and you might prefer doing this manually with the <code>haven</code>
package. One particular sticking point is the length of variable names -
R is not restrictive in this respect, but other software can be.
<code>secuTrialR</code> does not truncate names, prefering to leave this
to the user, which can cause <code><a href="../reference/write_secuTrial.html">write_secuTrial()</a></code> to fail with
an error. </p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve path to a temporary directory</span></span>
<span><span class="va">tdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># write spss</span></span>
<span><span class="fu"><a href="../reference/write_secuTrial.html">write_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>, format <span class="op">=</span> <span class="st">"sav"</span>, path <span class="op">=</span> <span class="va">tdir</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subsetting-secutrialdata">Subsetting <code>secuTrialdata</code><a class="anchor" aria-label="anchor" href="#subsetting-secutrialdata"></a>
</h3>
<p>In some cases it may be useful to subset your
<code>secuTrialdata</code> object. For example if you have cohort data
and would like to supply a subset of the data for a retrospective study.
We have implemented this option with <code><a href="../reference/subset_secuTrial.html">subset_secuTrial()</a></code>. It
will truncate your <code>secuTrialdata</code> object and return a new
<code>secuTrialdata</code> object which is a subset of the original
data. It is possible to subset by including or excluding specific
participant ids or centres. </p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initialize some subset identifiers</span></span>
<span><span class="va">participants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RPACK-INS-011"</span>, <span class="st">"RPACK-INS-014"</span>, <span class="st">"RPACK-INS-015"</span><span class="op">)</span></span>
<span><span class="va">centres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Inselspital Bern (RPACK)"</span>, <span class="st">"Universitätsspital Basel (RPACK)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exclude Bern and Basel</span></span>
<span><span class="va">ctu05_data_berlin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_secuTrial.html">subset_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>, centre <span class="op">=</span> <span class="va">centres</span>, exclude <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; If you changed any labels in the secuTrialdata object manually these will be reset to their original state.</span></span>
<span><span class="co"># exclude Berlin</span></span>
<span><span class="va">ctu05_data_bern_basel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_secuTrial.html">subset_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>, centre <span class="op">=</span> <span class="va">centres</span><span class="op">)</span></span>
<span><span class="co">#&gt; If you changed any labels in the secuTrialdata object manually these will be reset to their original state.</span></span>
<span><span class="co"># keep only subset of participants</span></span>
<span><span class="va">ctu05_data_pids</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_secuTrial.html">subset_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>, participant <span class="op">=</span> <span class="va">participants</span><span class="op">)</span></span>
<span><span class="co">#&gt; If you changed any labels in the secuTrialdata object manually these will be reset to their original state.</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data_berlin</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "secuTrialdata"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data_bern_basel</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "secuTrialdata"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ctu05_data_pids</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "secuTrialdata"</span></span></code></pre></div>
<p>If you subset based on centres all traces of deleted centres will be
removed. If you remove based on participant ids all traces of deleted
participants will be removed. </p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only Berlin remains</span></span>
<span><span class="va">ctu05_data_berlin</span><span class="op">$</span><span class="va">ctr</span></span>
<span><span class="co">#&gt;   mnpctrid             mnpctrname mnpcname</span></span>
<span><span class="co">#&gt; 1      462 Charité Berlin (RPACK)       NA</span></span>
<span></span>
<span><span class="co"># all centres remain even though all three participant ids are from Bern</span></span>
<span><span class="va">ctu05_data_pids</span><span class="op">$</span><span class="va">ctr</span></span>
<span><span class="co">#&gt;   mnpctrid                       mnpctrname mnpcname</span></span>
<span><span class="co">#&gt; 1      462           Charité Berlin (RPACK)       NA</span></span>
<span><span class="co">#&gt; 2      461         Inselspital Bern (RPACK)       NA</span></span>
<span><span class="co">#&gt; 3      441 Universitätsspital Basel (RPACK)       NA</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>Since the truncated object’s class remains unchanged
(i.e. <code>secuTrialdata</code>) you can still use the generic
functions on it. Let’s say you would only like to look at the
recruitment plot for Bern alone. </p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># keep only Bern</span></span>
<span><span class="va">ctu05_data_bern</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_secuTrial.html">subset_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>, centre <span class="op">=</span> <span class="st">"Inselspital Bern (RPACK)"</span><span class="op">)</span></span>
<span><span class="co">#&gt; If you changed any labels in the secuTrialdata object manually these will be reset to their original state.</span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="../reference/plot_recruitment.html">plot_recruitment</a></span><span class="op">(</span><span class="va">ctu05_data_bern</span><span class="op">)</span></span></code></pre></div>
<p><img src="secuTrialR-package-vignette_files/figure-html/unnamed-chunk-32-1.png" width="768"></p>
<p>… or Bern and Berlin. </p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># keep only Bern and Berlin</span></span>
<span><span class="va">ctu05_data_bern_berlin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_secuTrial.html">subset_secuTrial</a></span><span class="op">(</span><span class="va">ctu05_data</span>,</span>
<span>                                           centre <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Inselspital Bern (RPACK)"</span>,</span>
<span>                                                      <span class="st">"Charité Berlin (RPACK)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; If you changed any labels in the secuTrialdata object manually these will be reset to their original state.</span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="../reference/plot_recruitment.html">plot_recruitment</a></span><span class="op">(</span><span class="va">ctu05_data_bern_berlin</span><span class="op">)</span></span></code></pre></div>
<p><img src="secuTrialR-package-vignette_files/figure-html/unnamed-chunk-33-1.png" width="768"></p>
</div>
</div>
<div class="section level2">
<h2 id="building-urls-to-your-secutrial-server">Building URLs to your secuTrial server<a class="anchor" aria-label="anchor" href="#building-urls-to-your-secutrial-server"></a>
</h2>
<p>If you are creating reports in which you would like to directly link
to specific pages of your secuTrial DataCapture you can use
<code>build_secuTrial_url</code>. If you are no expert regarding the
secuTrial server architecture you would like to build links for, you
should talk to the server admin or consult the
<code>build_secuTrial_url</code> help page. They will be able to guide
you regarding the information for the <code>server</code>,
<code>instance</code>, <code>customer</code> and <code>project</code>
parameters. The <code>docid</code>, however, is included in your export
data in the non-meta data tables of the <code>secuTrialdata</code>
object and can be found in the <code>mnpdocid</code> columns.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">treatment</span><span class="op">$</span><span class="va">mnpdocid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 181 193 200 205 213 224</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">mnpdocid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 180 184 187 191 199 203</span></span></code></pre></div>
<p>To demsonstrate <code>build_secuTrial_url</code> we will use
imaginary data for the <code>server</code>, <code>instance</code>,
<code>customer</code> and <code>project</code> parameters. The real
counterparts on your server will likely look structurally similar.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="st">"server.secutrial.com"</span></span>
<span><span class="va">instance</span> <span class="op">&lt;-</span> <span class="st">"ST21-setup-DataCapture"</span></span>
<span><span class="va">customer</span> <span class="op">&lt;-</span> <span class="st">"TES"</span></span>
<span><span class="va">project</span> <span class="op">&lt;-</span> <span class="st">"7036"</span></span>
<span></span>
<span><span class="co"># make three links with the first three baseline docids</span></span>
<span><span class="va">bl_docids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">mnpdocid</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_secuTrial_url.html">build_secuTrial_url</a></span><span class="op">(</span><span class="va">server</span>, <span class="va">instance</span>, <span class="va">customer</span>,</span>
<span>                             <span class="va">project</span>, <span class="va">bl_docids</span><span class="op">)</span></span></code></pre></div>
<p><strong>These are the links</strong>:<br><a href="https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=180" class="external-link uri">https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=180</a></p>
<p><a href="https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=184" class="external-link uri">https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=184</a></p>
<p><a href="https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=187" class="external-link uri">https://server.secutrial.com/apps/WebObjects/ST21-setup-DataCapture.woa/wa/choose?customer=TES&amp;projectid=7036&amp;docid=187</a></p>
<p>Of course they are dead ends but maybe you can use them to make out
the arguments for your server.</p>
</div>
<div class="section level2">
<h2 id="the-as-data-frame-function">The <code>as.data.frame</code> function<a class="anchor" aria-label="anchor" href="#the-as-data-frame-function"></a>
</h2>
<p>This vignette has been working with the <code>secuTrialdata</code>
object, which is of type <code>list</code>. For some users, working with
a <code>list</code> can be tiresome so <code>secuTrialR</code> provides
an <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method to save the
<code>data.frame</code>s in the <code>secuTrialdata</code> object to an
environment of your choice.</p>
<p>As an example, we will create an environment called <code>env</code>
and check that it’s empty before running <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code>…
</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add files to env</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">ctu05_data</span>, envir <span class="op">=</span> <span class="va">env</span><span class="op">)</span></span></code></pre></div>
<p>… and afterwards. </p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "ae"              "allmedi"         "atae"            "atae1"          </span></span>
<span><span class="co">#&gt;  [5] "atallmedi"       "atbaseline"      "atesurgeries"    "atmiv"          </span></span>
<span><span class="co">#&gt;  [9] "atoutcome"       "atsae"           "atstudyterminat" "attreatment"    </span></span>
<span><span class="co">#&gt; [13] "baseline"        "esurgeries"      "outcome"         "sae"            </span></span>
<span><span class="co">#&gt; [17] "studyterminat"   "treatment"</span></span></code></pre></div>
<p>Substituting <code>env</code> with <code>.GlobalEnv</code> instead
would also be an option and would make the data.frames immediately
accessible without having to refer to an environment.</p>
</div>
<div class="section level2">
<h2 id="frequent-warning-messages">Frequent warning messages<a class="anchor" aria-label="anchor" href="#frequent-warning-messages"></a>
</h2>
<p>Certain <code>warning</code> messages can occur quite frequently when
running <code><a href="../reference/read_secuTrial.html">read_secuTrial()</a></code>. Some of them may call for
deliberate action and thus it is important to understand them. We
briefly mentioned some of them earlier in this document but will now
more closely explain how they can be interpreted.</p>
<p>Please note that <code>warning</code> messages may “pile up”
depending on the export you are reading. For example this may happen if
there are many date variables with incomplete data. This is no reason
for concern. We suggest that you read them and interpret them based on
the explanations below. We use <code>a_form_name</code> and
<code>a_variable_name</code> as place holders in the examples. If in
doubt you can always work with the raw data because it is never
overwritten.</p>
<div class="section level3">
<h3 id="dates">Dates<a class="anchor" aria-label="anchor" href="#dates"></a>
</h3>
<p>The below warning tells you that some data in a date variable could
not be converted during the process of date conversion
(i.e. <code><a href="../reference/dates_secuTrial.html">dates_secuTrial()</a></code>). This ususally occurs if
incomplete date entries are present. Since the raw data is not
overwritten but rather a <code>variable_name.date</code> or
<code>variable_name.datetime</code> column are added to the dataset you
can specifically see which values could not be converted because the raw
data will contain data while the corresponding
<code>.date</code>/<code>.datetime</code> entires will be
<code>NA</code>. The <code>warning</code> also indicates where to look.
The dummy example below indicates to look at the variable
<code>a_variable_name</code> in form <code>a_form_name</code>.</p>
<pre><code><span><span class="co">#&gt; Warning: In dates_secuTrial.data.frame(tmp, datevars, timevars, dateformat,  :</span></span>
<span><span class="co">#&gt; Not all dates were converted for</span></span>
<span><span class="co">#&gt; variable: 'a_variable_name'</span></span>
<span><span class="co">#&gt; in form: 'a_form_name'</span></span>
<span><span class="co">#&gt; This is likely due to incomplete date entries.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="factors">Factors<a class="anchor" aria-label="anchor" href="#factors"></a>
</h3>
<p>In some cases secuTrial allows differently coded data to be decoded
to the same target value for the same variable. For instance this can
happen if hierarchical lookuptables have been implemented in the
database. Because this interferes with the factorization
(i.e. <code><a href="../reference/factorize.html">factorize_secuTrial()</a></code>) we add the code to the
duplicate decoded value and return the below message to make you
aware.</p>
<p>If you run into this <code>warning</code> message we suggest running
the <code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> function on the variable in question. This will
likely clarify the above explanation.</p>
<pre><code><span><span class="co">#&gt; Warning: In factorize_secuTrial.data.frame(curr_form_data, cl = object$cl,  :</span></span>
<span><span class="co">#&gt; Duplicate values found during factorization of a_variable_name</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="labels">Labels<a class="anchor" aria-label="anchor" href="#labels"></a>
</h3>
<p>Sometimes the labels of variables in a secuTrial database
implementation may be changed after release of the database. In these
cases all labels (current and previous versions) are added to the
<code>label</code> attribute during labelling
(i.e. <code><a href="../reference/labels_secuTrial.html">label_secuTrial()</a></code>) and the below <code>warning</code>
is triggered. It indicates which variables in which forms are
affected.</p>
<pre><code><span><span class="co">#&gt; Warning: In label_secuTrial.secuTrialdata(d) :</span></span>
<span><span class="co">#&gt; The labels attribute may be longer than 1 for the following variables and forms.</span></span>
<span><span class="co">#&gt; Likely the label was changed from its original state in the secuTrial project setup.</span></span>
<span><span class="co">#&gt; variables: a_variable_name</span></span>
<span><span class="co">#&gt; forms: a_form_name</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="merging-forms-in-the-secutrialdata-object">Merging forms in the <code>secuTrialdata</code> object<a class="anchor" aria-label="anchor" href="#merging-forms-in-the-secutrialdata-object"></a>
</h2>
<p>Naturally, you will sometimes need to merge/join some of the data
from the individual form data stored in your <code>secuTrialdata</code>
object. To achieve this you can use the base R <code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code>
function. For our dataset we might be interested in merging the
<code>baseline</code> form data with that of the <code>treatment</code>
form. For this we can use the <code>mnpcvpid</code> which uniquely
identifies each participant visit. Since we are only interested in the
<code>rando_treatment</code> variable we will shrink the data in the
<code>treatment</code> form prior to merging.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treatment_shrink</span> <span class="op">&lt;-</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">treatment</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mnpcvpid"</span>, <span class="st">"rando_treatment"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Because we do not want to drop non-matching rows from
<code>baseline</code> we set <code>all.x = TRUE</code>. As you can see
from the <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code> calls, one column has been added after the
merge. This corresponds to the <code>rando_treatment</code>
variable.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bl_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span>, y <span class="op">=</span> <span class="va">treatment_shrink</span>,</span>
<span>                  by <span class="op">=</span> <span class="st">"mnpcvpid"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># check dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  17 107</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bl_treat</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  17 108</span></span></code></pre></div>
<p>Another common task may be to merge repetition form data to its
parent form. In our case <code>esurgeries</code> can be naively merged
with <code>baseline</code> via the <code>mnpdocid</code> (from the
secuTrial manual: “Each eCRF document record has a unique document
identifier.”):</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bl_surg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span>, y <span class="op">=</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">esurgeries</span>, by <span class="op">=</span> <span class="st">"mnpdocid"</span><span class="op">)</span></span></code></pre></div>
<p>Please note, that such naive merging can cause duplication of data if
the ids that the merge is directed by are not unique. This also happened
during the production of <code>bl_surg</code> in the code above.
Participant “RPACK-INS-012” exhibits the <code>mnpdocid</code> 234 twice
in the <code>esurgeries</code> repetition form which causes a
duplication of the <code>baseline</code> data matching
<code>mnpdocid</code> 234.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">esurgeries</span><span class="op">$</span><span class="va">mnpdocid</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 180 184 187 191 199 203 211 216 220 222 230 234 238 243 249 255 265 </span></span>
<span><span class="co">#&gt;   1   1   1   1   1   1   1   1   1   1   1   2   1   1   1   1   1</span></span></code></pre></div>
<p>Lets briefly illustrate the consequences by looking at a
<code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> of the <code>height</code> variable from the
<code>baseline</code> form before and after merging.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before merge</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 110.1   150 150.1   160 167.9 170.3 170.4   180 180.1 190.2 </span></span>
<span><span class="co">#&gt;     1     1     1     1     1     1     1     3     3     1</span></span>
<span></span>
<span><span class="co"># after merge</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">bl_surg</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 110.1   150 150.1   160 167.9 170.3 170.4   180 180.1 190.2 </span></span>
<span><span class="co">#&gt;     1     1     1     1     1     1     1     4     3     1</span></span></code></pre></div>
<p>A closer look reveals that <code>180</code> now appears four times
instead of three, which can be attributed to the duplication. This is
not a favourable outcome because it can cause confusion and
misinterpretation. A better approach is to change the structure of your
repetition form before merging to make the ids you merge by unique. For
this you need to investigate which data you would like to merge and
design an appropriate stategy. In our example case we are interested in
the <code>surgery_organ</code>. Of course we also need to drag the
<code>mnpdocid</code> along to perform the actual merge.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write a temporary object</span></span>
<span><span class="va">surg</span> <span class="op">&lt;-</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">esurgeries</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mnpdocid"</span>, <span class="st">"surgery_organ.factor"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># only retain non NA rows</span></span>
<span><span class="va">surg</span> <span class="op">&lt;-</span> <span class="va">surg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">surg</span><span class="op">$</span><span class="va">surgery_organ.factor</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># show it</span></span>
<span><span class="va">surg</span></span>
<span><span class="co">#&gt;    mnpdocid surgery_organ.factor</span></span>
<span><span class="co">#&gt; 12      234              Stomach</span></span>
<span><span class="co">#&gt; 13      234                Other</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>In order to prevent duplication we can restructure the data before
merging.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co"># pivot_wider</span></span>
<span><span class="co"># add a count</span></span>
<span><span class="va">surg</span><span class="op">$</span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="co"># show the data</span></span>
<span><span class="va">surg</span></span>
<span><span class="co">#&gt;    mnpdocid surgery_organ.factor count</span></span>
<span><span class="co">#&gt; 12      234              Stomach     1</span></span>
<span><span class="co">#&gt; 13      234                Other     1</span></span>
<span></span>
<span><span class="co"># make it wide</span></span>
<span><span class="va">surg_wide</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">surg</span>, names_from <span class="op">=</span> <span class="va">surgery_organ.factor</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span></span>
<span><span class="co"># show the wide data</span></span>
<span><span class="va">surg_wide</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">#&gt;   mnpdocid Stomach Other</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      234       1     1</span></span></code></pre></div>
<p>Checking the dimensions before and after merging reveals that the
structure, especially the line count, remains the same except for the
data added from the <code>esurgeries</code> repetition form
(i.e. <code>Stomach</code> and <code>Other</code>). Also, as expected,
the <code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code> of the height variable returns the expected
result (i.e. 180 is present three not four times).</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge</span></span>
<span><span class="va">bl_surg_no_dup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span>, y <span class="op">=</span> <span class="va">surg_wide</span>,</span>
<span>                        by <span class="op">=</span> <span class="st">"mnpdocid"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare dimensions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">bl_surg_no_dup</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  17 109</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">ctu05_data</span><span class="op">$</span><span class="va">baseline</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  17 107</span></span>
<span></span>
<span><span class="co"># check the height variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">bl_surg_no_dup</span><span class="op">$</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 110.1   150 150.1   160 167.9 170.3 170.4   180 180.1 190.2 </span></span>
<span><span class="co">#&gt;     1     1     1     1     1     1     1     3     3     1</span></span></code></pre></div>
<p>The above description only provides a very brief and simplified
example. Merging strategies need to be individually tailored and require
a good understanding of the data at hand. The
<code><a href="../reference/links_secuTrial.html">links_secuTrial()</a></code> function may be helpful to understand
which variables will allow you to merge forms.</p>
</div>
<div class="section level2">
<h2 id="a-note-on-mnp-variables">A note on <code>mnp*</code> variables<a class="anchor" aria-label="anchor" href="#a-note-on-mnp-variables"></a>
</h2>
<p>There is a plethora of variables in the tables of secuTrial exports
whose names start with <code>mnp</code>. These are metadata variables
which are e.g. important to logically link the different tables.
Explaining them all is beyond the scope of this vignette. For detailed
explanations, please refer to the secuTrial “Export Formats” user
manual.</p>
<div style="page-break-after: always;"></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.2.2 (2022-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-apple-darwin17.0 (64-bit)</span></span>
<span><span class="co">#&gt; Running under: macOS Big Sur ... 10.16</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS:   /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRblas.0.dylib</span></span>
<span><span class="co">#&gt; LAPACK: /Library/Frameworks/R.framework/Versions/4.2/Resources/lib/libRlapack.dylib</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt; [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt; [1] tidyr_1.3.0      secuTrialR_1.1.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] highr_0.10        cellranger_1.1.0  bslib_0.4.2       compiler_4.2.2   </span></span>
<span><span class="co">#&gt;  [5] pillar_1.8.1      jquerylib_0.1.4   forcats_1.0.0     tools_4.2.2      </span></span>
<span><span class="co">#&gt;  [9] bit_4.0.5         digest_0.6.31     timechange_0.2.0  lubridate_1.9.2  </span></span>
<span><span class="co">#&gt; [13] jsonlite_1.8.4    evaluate_0.20     memoise_2.0.1     lifecycle_1.0.3  </span></span>
<span><span class="co">#&gt; [17] tibble_3.1.8      pkgconfig_2.0.3   rlang_1.0.6       cli_3.6.0        </span></span>
<span><span class="co">#&gt; [21] parallel_4.2.2    yaml_2.3.7        haven_2.5.2       pkgdown_2.0.7    </span></span>
<span><span class="co">#&gt; [25] xfun_0.37         fastmap_1.1.1     withr_2.5.0       dplyr_1.1.0      </span></span>
<span><span class="co">#&gt; [29] stringr_1.5.0     knitr_1.42        generics_0.1.3    desc_1.4.2       </span></span>
<span><span class="co">#&gt; [33] fs_1.6.1          vctrs_0.5.2       sass_0.4.5        systemfonts_1.0.4</span></span>
<span><span class="co">#&gt; [37] hms_1.1.2         bit64_4.0.5       tidyselect_1.2.0  rprojroot_2.0.3  </span></span>
<span><span class="co">#&gt; [41] tufte_0.12        glue_1.6.2        R6_2.5.1          textshaping_0.3.6</span></span>
<span><span class="co">#&gt; [45] fansi_1.0.4       readxl_1.4.2      vroom_1.6.1       rmarkdown_2.20   </span></span>
<span><span class="co">#&gt; [49] tzdb_0.3.0        readr_2.1.4       purrr_1.0.1       magrittr_2.0.3   </span></span>
<span><span class="co">#&gt; [53] htmltools_0.5.4   ellipsis_0.3.2    ragg_1.2.5        utf8_1.2.3       </span></span>
<span><span class="co">#&gt; [57] stringi_1.7.12    cachem_1.0.7      crayon_1.5.2</span></span></code></pre></div>
<p><strong>Disclaimer</strong></p>
<p>The descriptions of the secuTrial exports used in this vignette and
other <code>secuTrialR</code> documentation correspond to our
understanding of them and come with no warranty. For in depth details
please refer to the original secuTrial manuals.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alan G. Haynes, Patrick R. Wright, Milica Markovic.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
